{% extends "base.html" %}

{% block title %}WasteWatch AI - Blog Posts{% endblock %}
{% block page_title %}Blog Posts{% endblock %}

{% block content %}
<div class="page-actions">
    <div class="page-info">
        <span>{{ total }} blog posts</span>
    </div>
    <div class="page-buttons">
        <button class="btn btn-accent btn-sm" id="btn-generate-blogs" onclick="generateBlogs()">
            <i data-lucide="sparkles"></i> Generate New
        </button>
    </div>
</div>

<div class="blog-grid">
    {% if blogs %}
    {% for blog in blogs %}
    <div class="blog-card" id="blog-card-{{ blog.id }}">
        <div class="blog-card-header">
            <span
                class="badge badge-{{ 'success' if blog.status == 'published' else ('info' if blog.status == 'ready' else 'default') }}">
                {{ blog.status | capitalize }}
            </span>
            <span class="blog-date">{{ blog.created_at | timeago }}</span>
        </div>
        <h3 class="blog-card-title">
            <a href="/blog/{{ blog.id }}">{{ blog.headline | truncate_text(100) }}</a>
        </h3>
        <p class="blog-card-excerpt">{{ blog.meta_description | truncate_text(140) }}</p>
        {% if blog.tags %}
        <div class="blog-card-tags">
            {% for tag in blog.tags.split(',')[:4] %}
            <span class="tag-chip">{{ tag.strip() }}</span>
            {% endfor %}
        </div>
        {% endif %}
        <div class="blog-card-actions">
            <a href="/blog/{{ blog.id }}" class="btn btn-ghost btn-xs">
                <i data-lucide="edit-3"></i> View
            </a>
            <a href="/blog/{{ blog.id }}/preview" class="btn btn-ghost btn-xs" target="_blank">
                <i data-lucide="eye"></i> Preview
            </a>
            <button class="btn btn-ghost btn-xs" onclick="exportBlog({{ blog.id }})">
                <i data-lucide="download"></i> Export
            </button>
            {% if wp_configured %}
            <button class="btn btn-ghost btn-xs" onclick="publishToWP({{ blog.id }})">
                <i data-lucide="upload"></i> Publish
            </button>
            {% endif %}
            <button class="btn btn-ghost btn-xs btn-danger-text" onclick="deleteBlog({{ blog.id }})">
                <i data-lucide="trash-2"></i>
            </button>
        </div>
    </div>
    {% endfor %}
    {% else %}
    <div class="empty-state large full-width">
        <i data-lucide="file-text"></i>
        <h3>No Blog Posts Yet</h3>
        <p>Generate blog posts from scraped articles using AI.</p>
        <button class="btn btn-accent" onclick="generateBlogs()">
            <i data-lucide="sparkles"></i> Generate Blog Posts
        </button>
    </div>
    {% endif %}
</div>

{% if total_pages > 1 %}
<div class="pagination">
    {% if page > 1 %}
    <a href="/blogs?page={{ page - 1 }}" class="btn btn-ghost btn-sm">← Previous</a>
    {% endif %}
    <span class="page-info">Page {{ page }} of {{ total_pages }}</span>
    {% if page < total_pages %} <a href="/blogs?page={{ page + 1 }}" class="btn btn-ghost btn-sm">Next →</a>
        {% endif %}
</div>
{% endif %}
{% endblock %}